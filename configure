#!/bin/bash
source /etc/os-release
OPT_DEPS="tmux fzf vim-ale ripgrep"
VIM_LINK_FOLDER="$VIM_LINK_FOLDER/"
DEPS="gawk make vim git $OPT_DEPS"
[[ "$(whoami)" != "root" ]] && echo "run as root" && exit 1

unlink_files(){
  dir="$1"
  dir_name="$2"
  ls $dir | while read file; do
  rm -f "$VIM_LINK_FOLDER/$dir_name/$file"
done
}
install(){
  case $ID in
    "arch")
      pacman -S $DEPS
      ;;
    "debian"|"ubuntu")
      apt install $DEPS
      # installing fzf vim integration
      mkdir -p $VIM_LINK_FOLDER/plugin/ && ln -fs /usr/share/doc/fzf/examples/plugin/fzf.vim $VIM_LINK_FOLDER/plugin/
      # installing vim-ale vim integration
      mkdir -p $VIM_LINK_FOLDER/autoload/ && ln -fs /usr/share/vim-ale/autoload/* $VIM_LINK_FOLDER/autoload
      mkdir -p $VIM_LINK_FOLDER/syntax/ && ln -fs /usr/share/vim-ale/syntax/* $VIM_LINK_FOLDER/syntax
      mkdir -p $VIM_LINK_FOLDER/ftplugin/ && ln -fs /usr/share/vim-ale/ftplugin/* $VIM_LINK_FOLDER/ftplugin
      mkdir -p $VIM_LINK_FOLDER/rplugin/ && ln -fs /usr/share/vim-ale/rplugin/* $VIM_LINK_FOLDER/rplugin
      mkdir -p $VIM_LINK_FOLDER/ale_linters/ && ln -fs /usr/share/vim-ale/ale_linters/* $VIM_LINK_FOLDER/ale_linters
      ;;
  esac
}

uninstall(){
  case $ID in
    "arch")
      pacman -Rns $OPT_DEPS
      ;;
    "debian"|"ubuntu")
      rm -r $VIM_LINK_FOLDER/plugin/fzf.vim
      unlink_files /usr/share/vim-ale/autoload autoload
      unlink_files /usr/share/vim-ale/ftplugin ftplugin
      unlink_files /usr/share/vim-ale/rplugin rplugin
      unlink_files /usr/share/vim-ale/syntax syntax
      unlink_files /usr/share/vim-ale/ale_linters ale_linters
      apt remove $OPT_DEPS
      ;;
  esac
}

case $1 in
  "uninstall")
    uninstall
    ;;
  *)
    install
    ;;
esac
